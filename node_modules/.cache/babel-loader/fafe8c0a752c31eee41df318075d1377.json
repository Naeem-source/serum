{"ast":null,"code":"import _regeneratorRuntime from\"/home/itxnaeem/Work-IDEO/Serumdex/serum/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/home/itxnaeem/Work-IDEO/Serumdex/serum/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/itxnaeem/Work-IDEO/Serumdex/serum/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"/home/itxnaeem/Work-IDEO/Serumdex/serum/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import*as BufferLayout from'buffer-layout';import bs58 from'bs58';import{PublicKey}from'@solana/web3.js';import{WRAPPED_SOL_MINT}from'@project-serum/serum/lib/token-instructions';import{TOKEN_MINTS}from'@project-serum/serum';import{useAllMarkets,useCustomMarkets,useTokenAccounts}from'./markets';import{getMultipleSolanaAccounts}from'./send';import{useConnection}from'./connection';import{useAsyncData}from'./fetch-loop';import tuple from'immutable-tuple';import BN from'bn.js';import{useMemo}from'react';export var ACCOUNT_LAYOUT=BufferLayout.struct([BufferLayout.blob(32,'mint'),BufferLayout.blob(32,'owner'),BufferLayout.nu64('amount'),BufferLayout.blob(93)]);export var MINT_LAYOUT=BufferLayout.struct([BufferLayout.blob(36),BufferLayout.blob(8,'supply'),BufferLayout.u8('decimals'),BufferLayout.u8('initialized'),BufferLayout.blob(36)]);export function parseTokenAccountData(data){var _ACCOUNT_LAYOUT$decod=ACCOUNT_LAYOUT.decode(data),mint=_ACCOUNT_LAYOUT$decod.mint,owner=_ACCOUNT_LAYOUT$decod.owner,amount=_ACCOUNT_LAYOUT$decod.amount;return{mint:new PublicKey(mint),owner:new PublicKey(owner),amount:amount};}export function parseTokenMintData(data){var _MINT_LAYOUT$decode=MINT_LAYOUT.decode(data),decimals=_MINT_LAYOUT$decode.decimals,initialized=_MINT_LAYOUT$decode.initialized,supply=_MINT_LAYOUT$decode.supply;return{decimals:decimals,initialized:!!initialized,supply:new BN(supply,10,'le')};}export function getOwnedAccountsFilters(publicKey){return[{memcmp:{offset:ACCOUNT_LAYOUT.offsetOf('owner'),bytes:publicKey.toBase58()}},{dataSize:ACCOUNT_LAYOUT.span}];}export var TOKEN_PROGRAM_ID=new PublicKey('TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA');export function getOwnedTokenAccounts(_x,_x2){return _getOwnedTokenAccounts.apply(this,arguments);}function _getOwnedTokenAccounts(){_getOwnedTokenAccounts=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(connection,publicKey){var filters,resp;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:filters=getOwnedAccountsFilters(publicKey);// @ts-ignore\n_context2.next=3;return connection._rpcRequest('getProgramAccounts',[TOKEN_PROGRAM_ID.toBase58(),{commitment:connection.commitment,filters:filters}]);case 3:resp=_context2.sent;if(!resp.error){_context2.next=6;break;}throw new Error('failed to get token accounts owned by '+publicKey.toBase58()+': '+resp.error.message);case 6:return _context2.abrupt(\"return\",resp.result.map(function(_ref4){var pubkey=_ref4.pubkey,_ref4$account=_ref4.account,data=_ref4$account.data,executable=_ref4$account.executable,owner=_ref4$account.owner,lamports=_ref4$account.lamports;return{publicKey:new PublicKey(pubkey),accountInfo:{data:bs58.decode(data),executable:executable,owner:new PublicKey(owner),lamports:lamports}};}).filter(function(_ref5){var accountInfo=_ref5.accountInfo;// TODO: remove this check once mainnet is updated\nreturn filters.every(function(filter){if(filter.dataSize){return accountInfo.data.length===filter.dataSize;}else if(filter.memcmp){var filterBytes=bs58.decode(filter.memcmp.bytes);return accountInfo.data.slice(filter.memcmp.offset,filter.memcmp.offset+filterBytes.length).equals(filterBytes);}return false;});}));case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _getOwnedTokenAccounts.apply(this,arguments);}export function getTokenAccountInfo(_x3,_x4){return _getTokenAccountInfo.apply(this,arguments);}// todo: use this to map custom mints to custom tickers. Add functionality once custom markets store mints\nfunction _getTokenAccountInfo(){_getTokenAccountInfo=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(connection,ownerAddress){var _yield$Promise$all,_yield$Promise$all2,splAccounts,account,parsedSplAccounts;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return Promise.all([getOwnedTokenAccounts(connection,ownerAddress),connection.getAccountInfo(ownerAddress)]);case 2:_yield$Promise$all=_context3.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);splAccounts=_yield$Promise$all2[0];account=_yield$Promise$all2[1];parsedSplAccounts=splAccounts.map(function(_ref6){var publicKey=_ref6.publicKey,accountInfo=_ref6.accountInfo;return{pubkey:publicKey,account:accountInfo,effectiveMint:parseTokenAccountData(accountInfo.data).mint};});return _context3.abrupt(\"return\",parsedSplAccounts.concat({pubkey:ownerAddress,account:account,effectiveMint:WRAPPED_SOL_MINT}));case 8:case\"end\":return _context3.stop();}}},_callee3);}));return _getTokenAccountInfo.apply(this,arguments);}export function useMintToTickers(){var _useCustomMarkets=useCustomMarkets(),customMarkets=_useCustomMarkets.customMarkets;return useMemo(function(){return Object.fromEntries(TOKEN_MINTS.map(function(mint){return[mint.address.toBase58(),mint.name];}));// eslint-disable-next-line react-hooks/exhaustive-deps\n},[customMarkets.length]);}var _VERY_SLOW_REFRESH_INTERVAL=5000*1000;// todo: move this to using mints stored in static market infos once custom markets support that.\nexport function useMintInfos(){var connection=useConnection();var _useTokenAccounts=useTokenAccounts(),_useTokenAccounts2=_slicedToArray(_useTokenAccounts,1),tokenAccounts=_useTokenAccounts2[0];var _useAllMarkets=useAllMarkets(),_useAllMarkets2=_slicedToArray(_useAllMarkets,1),allMarkets=_useAllMarkets2[0];var allMints=(tokenAccounts||[]).map(function(account){return account.effectiveMint;}).concat((allMarkets||[]).map(function(marketInfo){return marketInfo.market.baseMintAddress;})).concat((allMarkets||[]).map(function(marketInfo){return marketInfo.market.quoteMintAddress;}));var uniqueMints=_toConsumableArray(new Set(allMints.map(function(mint){return mint.toBase58();}))).map(function(stringMint){return new PublicKey(stringMint);});var getAllMintInfo=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var mintInfos;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getMultipleSolanaAccounts(connection,uniqueMints);case 2:mintInfos=_context.sent;return _context.abrupt(\"return\",Object.fromEntries(Object.entries(mintInfos.value).map(function(_ref2){var _ref3=_slicedToArray(_ref2,2),key=_ref3[0],accountInfo=_ref3[1];return[key,accountInfo&&parseTokenMintData(accountInfo.data)];})));case 4:case\"end\":return _context.stop();}}},_callee);}));return function getAllMintInfo(){return _ref.apply(this,arguments);};}();return useAsyncData(getAllMintInfo,tuple('getAllMintInfo',connection,(tokenAccounts||[]).length,(allMarkets||[]).length),{refreshInterval:_VERY_SLOW_REFRESH_INTERVAL});}","map":{"version":3,"sources":["/home/itxnaeem/Work-IDEO/Serumdex/serum/src/utils/tokens.tsx"],"names":["BufferLayout","bs58","PublicKey","WRAPPED_SOL_MINT","TOKEN_MINTS","useAllMarkets","useCustomMarkets","useTokenAccounts","getMultipleSolanaAccounts","useConnection","useAsyncData","tuple","BN","useMemo","ACCOUNT_LAYOUT","struct","blob","nu64","MINT_LAYOUT","u8","parseTokenAccountData","data","decode","mint","owner","amount","parseTokenMintData","decimals","initialized","supply","getOwnedAccountsFilters","publicKey","memcmp","offset","offsetOf","bytes","toBase58","dataSize","span","TOKEN_PROGRAM_ID","getOwnedTokenAccounts","connection","filters","_rpcRequest","commitment","resp","error","Error","message","result","map","pubkey","account","executable","lamports","accountInfo","filter","every","length","filterBytes","slice","equals","getTokenAccountInfo","ownerAddress","Promise","all","getAccountInfo","splAccounts","parsedSplAccounts","effectiveMint","concat","useMintToTickers","customMarkets","Object","fromEntries","address","name","_VERY_SLOW_REFRESH_INTERVAL","useMintInfos","tokenAccounts","allMarkets","allMints","marketInfo","market","baseMintAddress","quoteMintAddress","uniqueMints","Set","stringMint","getAllMintInfo","mintInfos","entries","value","key","refreshInterval"],"mappings":"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","sourcesContent":["import * as BufferLayout from 'buffer-layout';\nimport bs58 from 'bs58';\nimport {AccountInfo, Connection, PublicKey} from '@solana/web3.js';\nimport {WRAPPED_SOL_MINT} from '@project-serum/serum/lib/token-instructions';\nimport {TokenAccount} from './types';\nimport {TOKEN_MINTS} from '@project-serum/serum';\nimport {useAllMarkets, useCustomMarkets, useTokenAccounts} from './markets';\nimport {getMultipleSolanaAccounts} from './send';\nimport {useConnection} from './connection';\nimport {useAsyncData} from './fetch-loop';\nimport tuple from 'immutable-tuple';\nimport BN from 'bn.js';\nimport {useMemo} from 'react';\n\nexport const ACCOUNT_LAYOUT = BufferLayout.struct([\n  BufferLayout.blob(32, 'mint'),\n  BufferLayout.blob(32, 'owner'),\n  BufferLayout.nu64('amount'),\n  BufferLayout.blob(93),\n]);\n\nexport const MINT_LAYOUT = BufferLayout.struct([\n  BufferLayout.blob(36),\n  BufferLayout.blob(8, 'supply'),\n  BufferLayout.u8('decimals'),\n  BufferLayout.u8('initialized'),\n  BufferLayout.blob(36),\n]);\n\nexport function parseTokenAccountData(\n  data: Buffer,\n): { mint: PublicKey; owner: PublicKey; amount: number } {\n  let { mint, owner, amount } = ACCOUNT_LAYOUT.decode(data);\n  return {\n    mint: new PublicKey(mint),\n    owner: new PublicKey(owner),\n    amount,\n  };\n}\n\nexport interface MintInfo {\n  decimals: number;\n  initialized: boolean;\n  supply: BN;\n}\n\nexport function parseTokenMintData(data): MintInfo {\n  let { decimals, initialized, supply } = MINT_LAYOUT.decode(data);\n  return {\n    decimals,\n    initialized: !!initialized,\n    supply: new BN(supply, 10, 'le'),\n  };\n}\n\nexport function getOwnedAccountsFilters(publicKey: PublicKey) {\n  return [\n    {\n      memcmp: {\n        offset: ACCOUNT_LAYOUT.offsetOf('owner'),\n        bytes: publicKey.toBase58(),\n      },\n    },\n    {\n      dataSize: ACCOUNT_LAYOUT.span,\n    },\n  ];\n}\n\nexport const TOKEN_PROGRAM_ID = new PublicKey(\n  'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA',\n);\n\nexport async function getOwnedTokenAccounts(\n  connection: Connection,\n  publicKey: PublicKey,\n): Promise<Array<{ publicKey: PublicKey; accountInfo: AccountInfo<Buffer> }>> {\n  let filters = getOwnedAccountsFilters(publicKey);\n  // @ts-ignore\n  let resp = await connection._rpcRequest('getProgramAccounts', [\n    TOKEN_PROGRAM_ID.toBase58(),\n    {\n      commitment: connection.commitment,\n      filters,\n    },\n  ]);\n  if (resp.error) {\n    throw new Error(\n      'failed to get token accounts owned by ' +\n        publicKey.toBase58() +\n        ': ' +\n        resp.error.message,\n    );\n  }\n  return resp.result\n    .map(({ pubkey, account: { data, executable, owner, lamports } }) => ({\n      publicKey: new PublicKey(pubkey),\n      accountInfo: {\n        data: bs58.decode(data),\n        executable,\n        owner: new PublicKey(owner),\n        lamports,\n      },\n    }))\n    .filter(({ accountInfo }) => {\n      // TODO: remove this check once mainnet is updated\n      return filters.every((filter) => {\n        if (filter.dataSize) {\n          return accountInfo.data.length === filter.dataSize;\n        } else if (filter.memcmp) {\n          let filterBytes = bs58.decode(filter.memcmp.bytes);\n          return accountInfo.data\n            .slice(\n              filter.memcmp.offset,\n              filter.memcmp.offset + filterBytes.length,\n            )\n            .equals(filterBytes);\n        }\n        return false;\n      });\n    });\n}\n\nexport async function getTokenAccountInfo(\n  connection: Connection,\n  ownerAddress: PublicKey,\n) {\n  let [splAccounts, account] = await Promise.all([\n    getOwnedTokenAccounts(connection, ownerAddress),\n    connection.getAccountInfo(ownerAddress),\n  ]);\n  const parsedSplAccounts: TokenAccount[] = splAccounts.map(\n    ({ publicKey, accountInfo }) => {\n      return {\n        pubkey: publicKey,\n        account: accountInfo,\n        effectiveMint: parseTokenAccountData(accountInfo.data).mint,\n      };\n    },\n  );\n  return parsedSplAccounts.concat({\n    pubkey: ownerAddress,\n    account,\n    effectiveMint: WRAPPED_SOL_MINT,\n  });\n}\n\n// todo: use this to map custom mints to custom tickers. Add functionality once custom markets store mints\nexport function useMintToTickers(): { [mint: string]: string } {\n  const { customMarkets } = useCustomMarkets();\n  return useMemo(() => {\n    return Object.fromEntries(\n      TOKEN_MINTS.map((mint) => [mint.address.toBase58(), mint.name]),\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [customMarkets.length]);\n}\n\nconst _VERY_SLOW_REFRESH_INTERVAL = 5000 * 1000;\n\n// todo: move this to using mints stored in static market infos once custom markets support that.\nexport function useMintInfos(): [\n  (\n    | {\n        [mintAddress: string]: {\n          decimals: number;\n          initialized: boolean;\n        } | null;\n      }\n    | null\n    | undefined\n  ),\n  boolean,\n] {\n  const connection = useConnection();\n  const [tokenAccounts] = useTokenAccounts();\n  const [allMarkets] = useAllMarkets();\n\n  const allMints = (tokenAccounts || [])\n    .map((account) => account.effectiveMint)\n    .concat(\n      (allMarkets || []).map((marketInfo) => marketInfo.market.baseMintAddress),\n    )\n    .concat(\n      (allMarkets || []).map(\n        (marketInfo) => marketInfo.market.quoteMintAddress,\n      ),\n    );\n  const uniqueMints = [...new Set(allMints.map((mint) => mint.toBase58()))].map(\n    (stringMint) => new PublicKey(stringMint),\n  );\n\n  const getAllMintInfo = async () => {\n    const mintInfos = await getMultipleSolanaAccounts(connection, uniqueMints);\n    return Object.fromEntries(\n      Object.entries(mintInfos.value).map(([key, accountInfo]) => [\n        key,\n        accountInfo && parseTokenMintData(accountInfo.data),\n      ]),\n    );\n  };\n\n  return useAsyncData(\n    getAllMintInfo,\n    tuple(\n      'getAllMintInfo',\n      connection,\n      (tokenAccounts || []).length,\n      (allMarkets || []).length,\n    ),\n    { refreshInterval: _VERY_SLOW_REFRESH_INTERVAL },\n  );\n}\n"]},"metadata":{},"sourceType":"module"}